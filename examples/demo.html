<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FSH Syntax Highlighting - FHIR IG Integration Demo</title>

    <!-- Include Prism CSS -->
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/themes/prism.min.css" rel="stylesheet" />

    <!-- Include FSH FHIR IG styles -->
    <link href="../src/prism-lang-fsh.css" rel="stylesheet" />

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #f5f5f5;
        }
        
        h1 {
            color: #333;
            border-bottom: 3px solid #007acc;
            padding-bottom: 10px;
        }
        
        .demo-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h2 {
            color: #555;
            margin-top: 0;
        }
        
        .description {
            color: #666;
            margin-bottom: 20px;
        }
        
        pre[class*="language-"] {
            margin: 0;
            border-radius: 4px;
        }
        
        .installation {
            background: #e8f4fd;
            border-left: 4px solid #007acc;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .installation code {
            background: white;
            padding: 2px 6px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>FHIR Shorthand (FSH) Syntax Highlighting</h1>
    
    <div class="demo-section">
        <h2>FHIR IG Integration</h2>
        <p class="description">
            This demo showcases FML syntax highlighting with colors and styles specifically designed
            to integrate with FHIR Implementation Guide environments. The color scheme follows
            HL7's visual identity guidelines while providing clear, distinctive highlighting for
            all FML language constructs.
        </p>
        <div class="installation">
            <p><strong>Key Features:</strong></p>
            <ul>
                <li>✅ FHIR IG compliant color scheme</li>
                <li>✅ Dark theme support with <code>prefers-color-scheme</code></li>
                <li>✅ Print-friendly high contrast styling</li>
                <li>✅ Accessibility compliant (WCAG 2.1 AA)</li>
                <li>✅ Bootstrap integration for FHIR IGs</li>
            </ul>
        </div>
    </div>

    <div class="demo-section">
        <h2>Installation</h2>
        <div class="installation">
            <p>Include the following in your HTML:</p>
            <code>&lt;link href="path/to/prism.css" rel="stylesheet"&gt;</code><br>
            <code>&lt;link href="path/to/prism-lang-fsh.css" rel="stylesheet"&gt;</code><br>
            <code>&lt;script src="path/to/prism.js"&gt;&lt;/script&gt;</code><br>
            <code>&lt;script src="path/to/prism-lang-fsh.js"&gt;&lt;/script&gt;</code>
        </div>
    </div>

    <div class="demo-section">
        <h2>FSH Profile Definition</h2>
        <p class="description">
            A complete FSH profile definition with metadata, constraints, and extensions.
        </p>
        <pre><code class="language-fsh">// Enhanced Patient Profile for US Core
Alias: $sct = http://snomed.info/sct
Alias: $loinc = http://loinc.org

Profile: USCorePatientProfile
Parent: Patient
Id: us-core-patient
Title: "US Core Patient Profile"
Description: """
The US Core Patient Profile defines the minimum set of
constraints for Patient resources used in US implementations.
"""

// Metadata
* ^status = #active
* ^experimental = false
* ^date = "2024-01-15"

// Core constraints
* identifier 1..* MS
* identifier.system 1..1
* identifier.value 1..1
* name 1..* MS
* name.family 1..1 MS
* birthDate 1..1 MS
* gender from http://hl7.org/fhir/ValueSet/administrative-gender (required)

// Extensions
* extension contains
    USCoreRace named race 0..1 MS and
    USCoreEthnicity named ethnicity 0..1 MS</code></pre>
    </div>
    <div class="demo-section">
        <h2>FSH ValueSet Definition</h2>
        <p class="description">
            ValueSet definitions with includes, excludes, and terminology bindings.
        </p>
        <pre><code class="language-fsh">ValueSet: ObservationCategoryCodes
Id: observation-category
Title: "Observation Category Codes"
Description: "Codes for categorizing observations"

* include codes from system $loinc where concept is-a #LP7839-6
* include $sct#123456 "Laboratory finding"
* exclude $sct#999999 "Deprecated code"

// Binding example in profile
* category from ObservationCategoryCodes (extensible)</code></pre>
    </div>

    <!-- Advanced Features -->
    <div class="demo-section">
        <h2>Advanced FSH Features</h2>
        <p class="description">
            Complex FSH constructs including slicing, invariants, and RuleSets.
        </p>
        <pre><code class="language-fsh">// Address slicing with discriminator
* address ^slicing.discriminator.type = #pattern
* address ^slicing.discriminator.path = "use"
* address ^slicing.rules = #open
* address contains
    home 0..1 MS and
    work 0..*

* address[home].use = #home
* address[home].line 1..*
* address[work].use = #work

// Invariant definition
Invariant: patient-name-required
Description: "Patient must have either given or family name"
Expression: "name.given.exists() or name.family.exists()"
Severity: #error

// RuleSet for common patterns
RuleSet: CommonMetadata
* ^status = #active
* ^version = "1.0.0"
* ^experimental = false

// Using the RuleSet
Profile: AnotherProfile
Parent: Observation
* insert CommonMetadata</code></pre>    
    </div>
    <div class="demo-section">
        <h2>FSH Extension Definition</h2>
        <p class="description">
            Defining and using extensions in FSH.
        </p>
        <pre><code class="language-fsh">Extension: BirthPlace
Id: birthplace
Title: "Birth Place"
Description: "The location where the patient was born"
Context: Patient

* value[x] only Address
* valueAddress.city 1..1 MS
* valueAddress.country from iso3166-1-2 (required)

// Using the extension
* extension contains BirthPlace named birthPlace 0..1 MS
* extension[birthPlace].valueAddress.city 1..1</code></pre>
    </div>
    

    <!-- Mapping Example -->
     <div class="demo-section">
        <h2>FSH Mapping Definition</h2>
        <p class="description">
            Mapping FSH profiles to external standards.
        </p>
        <pre><code class="language-fsh">Mapping: PatientToV2
Id: patient-to-v2
Title: "Patient to HL7 v2 Mapping"
Source: USCorePatientProfile
Target: "HL7 v2 PID"

* identifier -> "PID.3"
* name.family -> "PID.5.1"
* name.given -> "PID.5.2"
* birthDate -> "PID.7"
* gender -> "PID.8"</code></pre>
    </div>

    <!-- Load Prism.js core -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/prism.min.js"></script>
    
    <!-- Load the fml language definition -->
    <!-- In production, this would be your minified plugin file -->
    <script src="../src/prism-lang-fsh.js"></script>
    
    <script>
        // Ensure everything is highlighted on load
        document.addEventListener('DOMContentLoaded', () => {
            Prism.highlightAll();
        });
    </script>
</body>
</html>
