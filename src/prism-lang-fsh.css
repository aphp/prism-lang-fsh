/*!
 * Prism Language FSH - FHIR IG Compatible Theme
 * FHIR Shorthand syntax highlighting theme for Prism.js
 * Optimized for integration with FHIR Implementation Guide templates
 * @version 0.1.0
 * @author AP-HP Development Team
 * @license MIT
 */

/* ==========================================================================
   CSS Custom Properties - FHIR IG Color Palette
   ========================================================================== */

:root {
  /* FHIR IG Brand Colors */
  --fhir-primary: #da0c23;
  --fhir-secondary: #505050;
  --fhir-muted: #999999;
  --fhir-text: #333333;

  /* FHIR Status Colors */
  --fhir-success: #5cb85c;
  --fhir-warning: #f0ad4e;
  --fhir-danger: #d9534f;
  --fhir-info: #5bc0de;

  /* Prism IG Standard Token Colors */
  --prism-background: #f5f2f0;
  --prism-text: #000000;
  --prism-comment: slategray;
  --prism-keyword: #07a;
  --prism-string: #690;
  --prism-function: #DD4A68;
  --prism-number: #905;
  --prism-operator: #9a6e3a;
  --prism-punctuation: #999999;

  /* FSH-specific Token Colors (aligned with FHIR concepts) */
  --fsh-definition: var(--fhir-primary);
  --fsh-metadata: var(--prism-keyword);
  --fsh-cardinality: var(--fhir-success);
  --fsh-modifier: var(--fhir-warning);
  --fsh-code: var(--prism-function);
  --fsh-variable: var(--prism-keyword);
  --fsh-path: var(--fhir-text);
  --fsh-url: var(--prism-keyword);

  /* Code Block Styling */
  --code-background: #eee;
  --code-border: #cccccc;
  --code-padding: 1px 4px;
  --code-radius: 4px;

  /* Typography */
  --font-family-base: "Helvetica Neue", Helvetica, Arial, sans-serif;
  --font-family-mono: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --font-size-base: 14px;
  --line-height-base: 1.428571429;
  --line-height-code: 1.5;
}

/* Dark theme overrides */
[data-theme="dark"], .dark {
  --fhir-text: #f0f6fc;
  --fhir-muted: #8b949e;
  --prism-background: #0d1117;
  --prism-text: #f0f6fc;
  --prism-comment: #8b949e;
  --prism-keyword: #79c0ff;
  --prism-string: #a5d6ff;
  --prism-function: #ff7b72;
  --prism-number: #79c0ff;
  --prism-operator: #ff7b72;
  --code-background: rgba(110, 118, 129, 0.2);
  --code-border: #30363d;
}

/* ==========================================================================
   FHIR Shorthand (FSH) Token Styling
   ========================================================================== */

/* Definition Keywords - Use FHIR primary color for prominence */
.token.definition-keyword,
.token.keyword.important {
  color: var(--fsh-definition);
  font-weight: bold;
}

/* Metadata Keywords - Standard keyword styling */
.token.metadata-keyword {
  color: var(--fsh-metadata);
  font-weight: bold;
}

/* Action Keywords - Subtle keyword styling */
.token.action-keyword {
  color: var(--fsh-metadata);
  font-weight: normal;
}

/* Modifiers and Flags - Warning color with background */
.token.modifier,
.token.important {
  color: var(--fsh-modifier);
  font-weight: bold;
  background: var(--code-background);
  padding: var(--code-padding);
  border-radius: var(--code-radius);
  border: 1px solid var(--code-border);
}

/* Cardinalities - Success color for constraints */
.token.cardinality {
  color: var(--fsh-cardinality);
  font-weight: bold;
}

/* Code References - Function color with inline styling */
.token.code,
.token.symbol {
  color: var(--fsh-code);
  background: var(--code-background);
  padding: var(--code-padding);
  border-radius: var(--code-radius);
  border: 1px solid var(--code-border);
  font-family: var(--font-family-mono);
  font-size: 1em;
  display: inline-block;
}

/* Code system part in code references */
.token.code .token.code-system {
  color: var(--prism-keyword);
  font-weight: bold;
}

/* Code value part */
.token.code .token.code-value {
  color: var(--fsh-code);
}

/* Alias Variables - Keyword color, bold */
.token.variable {
  color: var(--fsh-variable);
  font-weight: bold;
}

/* Alias definitions */
.token.alias .token.keyword {
  color: var(--fsh-definition);
  font-weight: bold;
}

.token.alias .token.variable {
  color: var(--fsh-variable);
  font-weight: bold;
}

/* Rule Paths - Text color for readability */
.token.rule-path {
  color: var(--fsh-path);
}

.token.rule-path .token.rule-indicator {
  color: var(--fsh-modifier);
  font-weight: bold;
}

.token.rule-path .token.path-component {
  color: var(--fsh-path);
}

.token.rule-path .token.slice-name {
  color: var(--fsh-code);
  background: var(--code-background);
  border-radius: var(--code-radius);
  padding: 1px 3px;
}

/* Caret Rules - Metadata rules */
.token.caret-rule .token.caret {
  color: var(--fsh-modifier);
  font-weight: bold;
}

.token.caret-rule .token.path-component {
  color: var(--fsh-metadata);
}

/* Binding Strengths - Emphasize with italic */
.token.binding-strength .token.keyword {
  color: var(--fsh-definition);
  font-style: italic;
  font-weight: bold;
}

/* Multi-line strings - Special highlighting */
.token.multiline-string {
  color: var(--prism-string);
  background: var(--code-background);
  border-left: 3px solid var(--prism-string);
  padding-left: 0.5em;
  font-style: italic;
  white-space: pre-wrap;
}

/* URLs - Link styling */
.token.url,
.token.link {
  color: var(--fsh-url);
  text-decoration: underline;
}

/* Standard Prism tokens aligned with IG */
.token.comment {
  color: var(--prism-comment);
  font-style: italic;
}

.token.string {
  color: var(--prism-string);
}

.token.number {
  color: var(--prism-number);
}

.token.date {
  color: var(--prism-string);
  background: var(--code-background);
  border-radius: var(--code-radius);
  padding: var(--code-padding);
}

.token.boolean {
  color: var(--prism-number);
  font-weight: bold;
}

.token.operator {
  color: var(--prism-operator);
}

.token.punctuation {
  color: var(--prism-punctuation);
}

.token.identifier {
  color: var(--prism-text);
}

/* ==========================================================================
   FHIR IG Integration Styles
   ========================================================================== */

/* Inline FSH code blocks (matching FHIRPath style) */
code.language-fsh {
  background: var(--code-background);
  border: 1px solid var(--code-border);
  padding: var(--code-padding);
  font-size: 1em;
  display: inline-block;
  text-shadow: none;
}

/* FSH code blocks */
pre.language-fsh {
  background: var(--code-background);
  border: 1px solid var(--code-border);
  text-shadow: none;
  white-space: pre-wrap;
  font-family: var(--font-family-mono);
  line-height: var(--line-height-code);
}

/* Remove custom styling that might conflict with IG themes */
pre[class*="language-"] {
  font-family: var(--font-family-mono);
  line-height: var(--line-height-code);
}

/* ==========================================================================
   High Contrast and Accessibility Support
   ========================================================================== */

@media (prefers-contrast: high) {
  :root {
    --fsh-definition: #a80000;
    --fsh-metadata: #5a1a6b;
    --fsh-modifier: #b8490a;
    --fsh-code: #5a1a6b;
    --fsh-variable: #003d82;
    --code-background: #ffffff;
    --code-border: #000000;
  }

  .token.modifier,
  .token.important {
    background: #fff2cc;
    border-color: #000000;
  }

  .token.code,
  .token.symbol {
    background: #f0f0f0;
    border-color: #000000;
  }
}

/* ==========================================================================
   Print Styles
   ========================================================================== */

@media print {
  :root {
    --fhir-text: #000000;
    --prism-text: #000000;
    --prism-comment: #666666;
    --code-background: #f0f0f0;
    --code-border: #cccccc;
  }

  .token.definition-keyword,
  .token.keyword.important,
  .token.metadata-keyword {
    color: #000000;
    font-weight: bold;
  }

  .token.modifier,
  .token.important,
  .token.code,
  .token.symbol {
    background: #f0f0f0;
    border: 1px solid #cccccc;
  }

  .token.url,
  .token.link {
    text-decoration: underline;
    color: #000000;
  }
}

/* ==========================================================================
   Performance and Compatibility
   ========================================================================== */

/* Ensure efficient rendering */
.token {
  display: inline;
}

/* Remove any expensive visual effects for better performance */
.token:not(.string):not(.comment) {
  text-shadow: none;
}

/* Maintain focus indicators for accessibility */
pre[class*="language-"]:focus {
  outline: 2px solid var(--fhir-primary);
  outline-offset: 2px;
}